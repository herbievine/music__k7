async function ye(e,t){const r=await e.formData();if(r)return ve(r,t);return{}}function ve(e,t){const r=Object.create(null);if(e.forEach((s,n)=>{if(!(t.all||n.endsWith("[]")))r[n]=s;else be(r,n,s)}),t.dot)Object.entries(r).forEach(([s,n])=>{if(s.includes("."))we(r,s,n),delete r[s]});return r}var te=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,i=(e instanceof H?e.raw.headers:e.headers).get("Content-Type");if(i?.startsWith("multipart/form-data")||i?.startsWith("application/x-www-form-urlencoded"))return ye(e,{all:r,dot:s});return{}},be=(e,t,r)=>{if(e[t]!==void 0)if(Array.isArray(e[t]))e[t].push(r);else e[t]=[e[t],r];else e[t]=r},we=(e,t,r)=>{let s=e;const n=t.split(".");n.forEach((i,c)=>{if(c===n.length-1)s[i]=r;else{if(!s[i]||typeof s[i]!=="object"||Array.isArray(s[i])||s[i]instanceof File)s[i]=Object.create(null);s=s[i]}})};var z=(e)=>{const t=e.split("/");if(t[0]==="")t.shift();return t},se=(e)=>{const{groups:t,path:r}=Pe(e),s=z(r);return Re(s,t)},Pe=(e)=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},Re=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},I={},A=(e)=>{if(e==="*")return"*";const t=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(t){if(!I[e])if(t[2])I[e]=[e,t[1],new RegExp("^"+t[2]+"$")];else I[e]=[e,t[1],!0];return I[e]}return null},B=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,(r)=>{try{return t(r)}catch{return r}})}},Oe=(e)=>B(e,decodeURI),V=(e)=>{const t=e.url,r=t.indexOf("/",8);let s=r;for(;s<t.length;s++){const n=t.charCodeAt(s);if(n===37){const i=t.indexOf("?",s),c=t.slice(r,i===-1?void 0:i);return Oe(c.includes("%25")?c.replace(/%25/g,"%2525"):c)}else if(n===63)break}return t.slice(r,s)};var re=(e)=>{const t=V(e);return t.length>1&&t[t.length-1]==="/"?t.slice(0,-1):t},P=(...e)=>{let t="",r=!1;for(let s of e){if(t[t.length-1]==="/")t=t.slice(0,-1),r=!0;if(s[0]!=="/")s=`/${s}`;if(s==="/"&&r)t=`${t}/`;else if(s!=="/")t=`${t}${s}`;if(s==="/"&&t==="")t="/"}return t},D=(e)=>{if(!e.match(/\:.+\?$/))return null;const t=e.split("/"),r=[];let s="";return t.forEach((n)=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){if(r.length===0&&s==="")r.push("/");else r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,c)=>c.indexOf(n)===i)},K=(e)=>{if(!/[%+]/.test(e))return e;if(e.indexOf("+")!==-1)e=e.replace(/\+/g," ");return e.indexOf("%")!==-1?U(e):e},ne=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let c=e.indexOf(`?${t}`,8);if(c===-1)c=e.indexOf(`&${t}`,8);while(c!==-1){const f=e.charCodeAt(c+t.length+1);if(f===61){const o=c+t.length+2,a=e.indexOf("&",o);return K(e.slice(o,a===-1?void 0:a))}else if(f==38||isNaN(f))return"";c=e.indexOf(`&${t}`,c+1)}if(s=/[%+]/.test(e),!s)return}const n={};s??=/[%+]/.test(e);let i=e.indexOf("?",8);while(i!==-1){const c=e.indexOf("&",i+1);let f=e.indexOf("=",i);if(f>c&&c!==-1)f=-1;let o=e.slice(i+1,f===-1?c===-1?void 0:c:f);if(s)o=K(o);if(i=c,o==="")continue;let a;if(f===-1)a="";else if(a=e.slice(f+1,c===-1?void 0:c),s)a=K(a);if(r){if(!(n[o]&&Array.isArray(n[o])))n[o]=[];n[o].push(a)}else n[o]??=a}return t?n[t]:n},ie=ne,oe=(e,t)=>{return ne(e,t,!0)},U=decodeURIComponent;var ce=(e)=>B(e,U),H=class{raw;#t;#n;routeIndex=0;path;bodyCache={};constructor(e,t="/",r=[[]]){this.raw=e,this.path=t,this.#n=r,this.#t={}}param(e){return e?this.#i(e):this.#o()}#i(e){const t=this.#n[0][this.routeIndex][1][e],r=this.#r(t);return r?/\%/.test(r)?ce(r):r:void 0}#o(){const e={},t=Object.keys(this.#n[0][this.routeIndex][1]);for(let r of t){const s=this.#r(this.#n[0][this.routeIndex][1][r]);if(s&&typeof s==="string")e[r]=/\%/.test(s)?ce(s):s}return e}#r(e){return this.#n[1]?this.#n[1][e]:e}query(e){return ie(this.url,e)}queries(e){return oe(this.url,e)}header(e){if(e)return this.raw.headers.get(e.toLowerCase())??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){return this.bodyCache.parsedBody??=await te(this,e)}#e=(e)=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const n=Object.keys(t)[0];if(n)return t[n].then((i)=>{if(n==="json")i=JSON.stringify(i);return new Response(i)[e]()});return t[e]=r[e]()};json(){return this.#e("json")}text(){return this.#e("text")}arrayBuffer(){return this.#e("arrayBuffer")}blob(){return this.#e("blob")}formData(){return this.#e("formData")}addValidatedData(e,t){this.#t[e]=t}valid(e){return this.#t[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return this.#n[0].map(([[,e]])=>e)}get routePath(){return this.#n[0].map(([[,e]])=>e)[this.routeIndex].path}};var fe={Stringify:1,BeforeStream:2,Stream:3},je=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r};var Q=async(e,t,r,s,n)=>{if(typeof e==="object"&&!(e instanceof String)){if(!(e instanceof Promise))e=e.toString();if(e instanceof Promise)e=await e}const i=e.callbacks;if(!i?.length)return Promise.resolve(e);if(n)n[0]+=e;else n=[e];const c=Promise.all(i.map((f)=>f({phase:t,buffer:n,context:s}))).then((f)=>Promise.all(f.filter(Boolean).map((o)=>Q(o,t,!1,s,n))).then(()=>n[0]));if(r)return je(await c,i);else return c};var Ee="text/plain; charset=UTF-8",W=(e,t={})=>{for(let r of Object.keys(t))e.set(r,t[r]);return e},F=class{#t;#n;env={};#i;finalized=!1;error;#o=200;#r;#e;#s;#f;#a=!0;#u;#h;#l;#d;#p;constructor(e,t){if(this.#t=e,t)this.#r=t.executionCtx,this.env=t.env,this.#l=t.notFoundHandler,this.#p=t.path,this.#d=t.matchResult}get req(){return this.#n??=new H(this.#t,this.#p,this.#d),this.#n}get event(){if(this.#r&&"respondWith"in this.#r)return this.#r;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#r)return this.#r;else throw Error("This context has no ExecutionContext")}get res(){return this.#a=!1,this.#f||=new Response("404 Not Found",{status:404})}set res(e){if(this.#a=!1,this.#f&&e)try{for(let[t,r]of this.#f.headers.entries()){if(t==="content-type")continue;if(t==="set-cookie"){const s=this.#f.headers.getSetCookie();e.headers.delete("set-cookie");for(let n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}}catch(t){if(t instanceof TypeError&&t.message.includes("immutable")){this.res=new Response(e.body,{headers:e.headers,status:e.status});return}else throw t}this.#f=e,this.finalized=!0}render=(...e)=>{return this.#h??=(t)=>this.html(t),this.#h(...e)};setLayout=(e)=>this.#u=e;getLayout=()=>this.#u;setRenderer=(e)=>{this.#h=e};header=(e,t,r)=>{if(t===void 0){if(this.#e)this.#e.delete(e);else if(this.#s)delete this.#s[e.toLocaleLowerCase()];if(this.finalized)this.res.headers.delete(e);return}if(r?.append){if(!this.#e)this.#a=!1,this.#e=new Headers(this.#s),this.#s={};this.#e.append(e,t)}else if(this.#e)this.#e.set(e,t);else this.#s??={},this.#s[e.toLowerCase()]=t;if(this.finalized)if(r?.append)this.res.headers.append(e,t);else this.res.headers.set(e,t)};status=(e)=>{this.#a=!1,this.#o=e};set=(e,t)=>{this.#i??=new Map,this.#i.set(e,t)};get=(e)=>{return this.#i?this.#i.get(e):void 0};get var(){if(!this.#i)return{};return Object.fromEntries(this.#i)}#c(e,t,r){if(this.#a&&!r&&!t&&this.#o===200)return new Response(e,{headers:this.#s});if(t&&typeof t!=="number"){const n=new Headers(t.headers);if(this.#e)this.#e.forEach((c,f)=>{if(f==="set-cookie")n.append(f,c);else n.set(f,c)});const i=W(n,this.#s);return new Response(e,{headers:i,status:t.status??this.#o})}const s=typeof t==="number"?t:this.#o;if(this.#s??={},this.#e??=new Headers,W(this.#e,this.#s),this.#f)this.#f.headers.forEach((n,i)=>{if(i==="set-cookie")this.#e?.append(i,n);else this.#e?.set(i,n)}),W(this.#e,this.#s);r??={};for(let[n,i]of Object.entries(r))if(typeof i==="string")this.#e.set(n,i);else{this.#e.delete(n);for(let c of i)this.#e.append(n,c)}return new Response(e,{status:s,headers:this.#e})}newResponse=(...e)=>this.#c(...e);body=(e,t,r)=>{return typeof t==="number"?this.#c(e,t,r):this.#c(e,t)};text=(e,t,r)=>{if(!this.#s){if(this.#a&&!r&&!t)return new Response(e);this.#s={}}return this.#s["content-type"]=Ee,typeof t==="number"?this.#c(e,t,r):this.#c(e,t)};json=(e,t,r)=>{const s=JSON.stringify(e);return this.#s??={},this.#s["content-type"]="application/json; charset=UTF-8",typeof t==="number"?this.#c(s,t,r):this.#c(s,t)};html=(e,t,r)=>{if(this.#s??={},this.#s["content-type"]="text/html; charset=UTF-8",typeof e==="object")return Q(e,fe.Stringify,!1,{}).then((s)=>{return typeof t==="number"?this.#c(s,t,r):this.#c(s,t)});return typeof t==="number"?this.#c(e,t,r):this.#c(e,t)};redirect=(e,t)=>{return this.#e??=new Headers,this.#e.set("Location",String(e)),this.newResponse(null,t??302)};notFound=()=>{return this.#l??=()=>new Response,this.#l(this)}};var _=(e,t,r)=>{return(s,n)=>{let i=-1;const c=s instanceof F;return f(0);async function f(o){if(o<=i)throw new Error("next() called multiple times");i=o;let a,h=!1,l;if(e[o]){if(l=e[o][0][0],c)s.req.routeIndex=o}else l=o===e.length&&n||void 0;if(!l){if(c&&s.finalized===!1&&r)a=await r(s)}else try{a=await l(s,()=>{return f(o+1)})}catch(u){if(u instanceof Error&&c&&t)s.error=u,a=await t(u,s),h=!0;else throw u}if(a&&(s.finalized===!1||h))s.res=a;return s}}};var d="ALL",ae="all",he=["get","post","put","delete","options","patch"],q="Can not add a route since the matcher is already built.",L=class extends Error{};var Se=Symbol("composedHandler"),$e=(e)=>{return e.text("404 Not Found",404)},le=(e,t)=>{if("getResponse"in e)return e.getResponse();return console.error(e),t.text("Internal Server Error",500)},X=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#t="/";routes=[];constructor(e={}){[...he,ae].forEach((s)=>{this[s]=(n,...i)=>{if(typeof n==="string")this.#t=n;else this.#r(s,this.#t,n);return i.forEach((c)=>{if(typeof c!=="string")this.#r(s,this.#t,c)}),this}}),this.on=(s,n,...i)=>{for(let c of[n].flat()){this.#t=c;for(let f of[s].flat())i.map((o)=>{this.#r(f.toUpperCase(),this.#t,o)})}return this},this.use=(s,...n)=>{if(typeof s==="string")this.#t=s;else this.#t="*",n.unshift(s);return n.forEach((i)=>{this.#r(d,this.#t,i)}),this};const r=e.strict??!0;delete e.strict,Object.assign(this,e),this.getPath=r?e.getPath??V:re}#n(){const e=new X({router:this.router,getPath:this.getPath});return e.routes=this.routes,e}#i=$e;#o=le;route(e,t){const r=this.basePath(e);return t.routes.map((s)=>{let n;if(t.#o===le)n=s.handler;else n=async(i,c)=>(await _([],t.#o)(i,()=>s.handler(i,c))).res,n[Se]=s.handler;r.#r(s.method,s.path,n)}),this}basePath(e){const t=this.#n();return t._basePath=P(this._basePath,e),t}onError=(e)=>{return this.#o=e,this};notFound=(e)=>{return this.#i=e,this};mount(e,t,r){let s,n;if(r)if(typeof r==="function")n=r;else n=r.optionHandler,s=r.replaceRequest;const i=n?(f)=>{const o=n(f);return Array.isArray(o)?o:[o]}:(f)=>{let o=void 0;try{o=f.executionCtx}catch{}return[f.env,o]};s||=(()=>{const f=P(this._basePath,e),o=f==="/"?0:f.length;return(a)=>{const h=new URL(a.url);return h.pathname=h.pathname.slice(o)||"/",new Request(h,a)}})();const c=async(f,o)=>{const a=await t(s(f.req.raw),...i(f));if(a)return a;await o()};return this.#r(d,P(e,"*"),c),this}#r(e,t,r){e=e.toUpperCase(),t=P(this._basePath,t);const s={path:t,method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)}#e(e,t){if(e instanceof Error)return this.#o(e,t);throw e}#s(e,t,r,s){if(s==="HEAD")return(async()=>new Response(null,await this.#s(e,t,r,"GET")))();const n=this.getPath(e,{env:r}),i=this.router.match(s,n),c=new F(e,{path:n,matchResult:i,env:r,executionCtx:t,notFoundHandler:this.#i});if(i[0].length===1){let o;try{o=i[0][0][0][0](c,async()=>{c.res=await this.#i(c)})}catch(a){return this.#e(a,c)}return o instanceof Promise?o.then((a)=>a||(c.finalized?c.res:this.#i(c))).catch((a)=>this.#e(a,c)):o??this.#i(c)}const f=_(i[0],this.#o,this.#i);return(async()=>{try{const o=await f(c);if(!o.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return o.res}catch(o){return this.#e(o,c)}})()}fetch=(e,...t)=>{return this.#s(e,t[1],t[0],e.method)};request=(e,t,r,s)=>{if(e instanceof Request){if(t!==void 0)e=new Request(e,t);return this.fetch(e,r,s)}e=e.toString();const n=/^https?:\/\//.test(e)?e:`http://localhost${P("/",e)}`,i=new Request(n,t);return this.fetch(i,r,s)};fire=()=>{addEventListener("fetch",(e)=>{e.respondWith(this.#s(e.request,e,void 0,e.request.method))})}};function He(e,t){if(e.length===1)return t.length===1?e<t?-1:1:-1;if(t.length===1)return 1;if(e===E||e===S)return 1;else if(t===E||t===S)return-1;if(e===T)return 1;else if(t===T)return-1;return e.length===t.length?e<t?-1:1:t.length-e.length}var T="[^/]+",E=".*",S="(?:|/.*)",R=Symbol(),Ne=new Set(".\\+*[^]$()"),m=class{index;varIndex;children=Object.create(null);insert(e,t,r,s,n){if(e.length===0){if(this.index!==void 0)throw R;if(n)return;this.index=t;return}const[i,...c]=e,f=i==="*"?c.length===0?["","",E]:["","",T]:i==="/*"?["","",S]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let o;if(f){const a=f[1];let h=f[2]||T;if(a&&f[2]){if(h=h.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(h))throw R}if(o=this.children[h],!o){if(Object.keys(this.children).some((l)=>l!==E&&l!==S))throw R;if(n)return;if(o=this.children[h]=new m,a!=="")o.varIndex=s.varIndex++}if(!n&&a!=="")r.push([a,o.varIndex])}else if(o=this.children[i],!o){if(Object.keys(this.children).some((a)=>a.length>1&&a!==E&&a!==S))throw R;if(n)return;o=this.children[i]=new m}o.insert(c,t,r,s,n)}buildRegExpStr(){const t=Object.keys(this.children).sort(He).map((r)=>{const s=this.children[r];return(typeof s.varIndex==="number"?`(${r})@${s.varIndex}`:Ne.has(r)?`\\${r}`:r)+s.buildRegExpStr()});if(typeof this.index==="number")t.unshift(`#${this.index}`);if(t.length===0)return"";if(t.length===1)return t[0];return"(?:"+t.join("|")+")"}};var ue=class{context={varIndex:0};root=new m;insert(e,t,r){const s=[],n=[];for(let c=0;;){let f=!1;if(e=e.replace(/\{[^}]+\}/g,(o)=>{const a=`@\\${c}`;return n[c]=[a,o],c++,f=!0,a}),!f)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let c=n.length-1;c>=0;c--){const[f]=n[c];for(let o=i.length-1;o>=0;o--)if(i[o].indexOf(f)!==-1){i[o]=i[o].replace(f,n[c][1]);break}}return this.root.insert(i,t,s,this.context,r),s}buildRegExp(){let e=this.root.buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,c)=>{if(i!==void 0)return r[++t]=Number(i),"$()";if(c!==void 0)return s[Number(c)]=++t,"";return""}),[new RegExp(`^${e}`),r,s]}};function ge(e){return pe[e]??=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}\$`)}function De(){pe=Object.create(null)}function Fe(e){const t=new ue,r=[];if(e.length===0)return Ie;const s=e.map((a)=>[!/\*|\/:/.test(a[0]),...a]).sort(([a,h],[l,u])=>a?1:l?-1:h.length-u.length),n=Object.create(null);for(let a=0,h=-1,l=s.length;a<l;a++){const[u,x,p]=s[a];if(u)n[x]=[p.map(([y])=>[y,Object.create(null)]),de];else h++;let g;try{g=t.insert(x,h,u)}catch(y){throw y===R?new L(x):y}if(u)continue;r[h]=p.map(([y,b])=>{const j=Object.create(null);b-=1;for(;b>=0;b--){const[v,$]=g[b];j[v]=$}return[y,j]})}const[i,c,f]=t.buildRegExp();for(let a=0,h=r.length;a<h;a++)for(let l=0,u=r[a].length;l<u;l++){const x=r[a][l]?.[1];if(!x)continue;const p=Object.keys(x);for(let g=0,y=p.length;g<y;g++)x[p[g]]=f[x[p[g]]]}const o=[];for(let a in c)o[a]=r[c[a]];return[i,o,n]}function O(e,t){if(!e)return;for(let r of Object.keys(e).sort((s,n)=>n.length-s.length))if(ge(r).test(t))return[...e[r]];return}var de=[],Ie=[/^$/,[],Object.create(null)],pe=Object.create(null),G=class{name="RegExpRouter";middleware;routes;constructor(){this.middleware={[d]:Object.create(null)},this.routes={[d]:Object.create(null)}}add(e,t,r){const{middleware:s,routes:n}=this;if(!s||!n)throw new Error(q);if(!s[e])[s,n].forEach((f)=>{f[e]=Object.create(null),Object.keys(f[d]).forEach((o)=>{f[e][o]=[...f[d][o]]})});if(t==="/*")t="*";const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const f=ge(t);if(e===d)Object.keys(s).forEach((o)=>{s[o][t]||=O(s[o],t)||O(s[d],t)||[]});else s[e][t]||=O(s[e],t)||O(s[d],t)||[];Object.keys(s).forEach((o)=>{if(e===d||e===o)Object.keys(s[o]).forEach((a)=>{f.test(a)&&s[o][a].push([r,i])})}),Object.keys(n).forEach((o)=>{if(e===d||e===o)Object.keys(n[o]).forEach((a)=>f.test(a)&&n[o][a].push([r,i]))});return}const c=D(t)||[t];for(let f=0,o=c.length;f<o;f++){const a=c[f];Object.keys(n).forEach((h)=>{if(e===d||e===h)n[h][a]||=[...O(s[h],a)||O(s[d],a)||[]],n[h][a].push([r,i-o+f+1])})}}match(e,t){De();const r=this.#t();return this.match=(s,n)=>{const i=r[s]||r[d],c=i[2][n];if(c)return c;const f=n.match(i[0]);if(!f)return[[],de];const o=f.indexOf("",1);return[i[1][o],f]},this.match(e,t)}#t(){const e=Object.create(null);return Object.keys(this.routes).concat(Object.keys(this.middleware)).forEach((t)=>{e[t]||=this.#n(t)}),this.middleware=this.routes=void 0,e}#n(e){const t=[];let r=e===d;if([this.middleware,this.routes].forEach((s)=>{const n=s[e]?Object.keys(s[e]).map((i)=>[i,s[e][i]]):[];if(n.length!==0)r||=!0,t.push(...n);else if(e!==d)t.push(...Object.keys(s[d]).map((i)=>[i,s[d][i]]))}),!r)return null;else return Fe(t)}};var J=class{name="SmartRouter";routers=[];routes=[];constructor(e){Object.assign(this,e)}add(e,t,r){if(!this.routes)throw new Error(q);this.routes.push([e,t,r])}match(e,t){if(!this.routes)throw new Error("Fatal error");const{routers:r,routes:s}=this,n=r.length;let i=0,c;for(;i<n;i++){const f=r[i];try{for(let o=0,a=s.length;o<a;o++)f.add(...s[o]);c=f.match(e,t)}catch(o){if(o instanceof L)continue;throw o}this.match=f.match.bind(f),this.routers=[f],this.routes=void 0;break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,c}get activeRouter(){if(this.routes||this.routers.length!==1)throw new Error("No active router has been determined yet.");return this.routers[0]}};var k=class{methods;children;patterns;order=0;params=Object.create(null);constructor(e,t,r){if(this.children=r||Object.create(null),this.methods=[],e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},this.methods=[s]}this.patterns=[]}insert(e,t,r){this.order=++this.order;let s=this;const n=se(t),i=[];for(let o=0,a=n.length;o<a;o++){const h=n[o];if(Object.keys(s.children).includes(h)){s=s.children[h];const u=A(h);if(u)i.push(u[1]);continue}s.children[h]=new k;const l=A(h);if(l)s.patterns.push(l),i.push(l[1]);s=s.children[h]}if(!s.methods.length)s.methods=[];const c=Object.create(null),f={handler:r,possibleKeys:i.filter((o,a,h)=>h.indexOf(o)===a),score:this.order};return c[e]=f,s.methods.push(c),s}#t(e,t,r,s){const n=[];for(let i=0,c=e.methods.length;i<c;i++){const f=e.methods[i],o=f[t]||f[d],a=Object.create(null);if(o!==void 0){o.params=Object.create(null);for(let h=0,l=o.possibleKeys.length;h<l;h++){const u=o.possibleKeys[h],x=a[o.score];o.params[u]=s[u]&&!x?s[u]:r[u]??s[u],a[o.score]=!0}n.push(o)}}return n}search(e,t){const r=[];this.params=Object.create(null);let n=[this];const i=z(t);for(let f=0,o=i.length;f<o;f++){const a=i[f],h=f===o-1,l=[];for(let u=0,x=n.length;u<x;u++){const p=n[u],g=p.children[a];if(g)if(g.params=p.params,h){if(g.children["*"])r.push(...this.#t(g.children["*"],e,p.params,Object.create(null)));r.push(...this.#t(g,e,p.params,Object.create(null)))}else l.push(g);for(let y=0,b=p.patterns.length;y<b;y++){const j=p.patterns[y],v={...p.params};if(j==="*"){const C=p.children["*"];if(C)r.push(...this.#t(C,e,p.params,Object.create(null))),l.push(C);continue}if(a==="")continue;const[$,M,N]=j,w=p.children[$],ee=i.slice(f).join("/");if(N instanceof RegExp&&N.test(ee)){v[M]=ee,r.push(...this.#t(w,e,p.params,v));continue}if(N===!0||N.test(a)){if(typeof $==="string")if(v[M]=a,h){if(r.push(...this.#t(w,e,v,p.params)),w.children["*"])r.push(...this.#t(w.children["*"],e,v,p.params))}else w.params=v,l.push(w)}}}n=l}return[r.sort((f,o)=>{return f.score-o.score}).map(({handler:f,params:o})=>[f,o])]}};var Z=class{name="TrieRouter";node;constructor(){this.node=new k}add(e,t,r){const s=D(t);if(s){for(let n=0,i=s.length;n<i;n++)this.node.insert(e,s[n],r);return}this.node.insert(e,t,r)}match(e,t){return this.node.search(e,t)}};var Y=class extends X{constructor(e={}){super(e);this.router=e.router??new J({routers:[new G,new Z]})}};var xe=new Y;xe.get("/download/:id",async(e)=>{const t=e.req.param("id"),r=await fetch(`https://haxel.herbievine.com/${t}`);if(!r.ok)return e.json({message:await r.text(),status:r.status},500);return e.json(await r.json())});var zt=xe;export{zt as default};
